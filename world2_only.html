<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
  <meta name="robots" content="noindex">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SELF//SOUND — WORLD2 (Story)</title>
<style>
  :root{--bg:#0f1113;--card:#141617;--muted:#9aa0a6;}
  body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Hiragino Kaku Gothic ProN","Noto Sans JP","Segoe UI",Roboto,Helvetica,Arial;padding:18px;background:linear-gradient(180deg,#09090b,#0f1113);color:#e6eef8;}
  .wrap{max-width:920px;margin:0 auto;}
  h1{font-weight:600;margin:0 0 10px 0;}
  .panel{background:var(--card);border-radius:12px;padding:14px;min-height:540px;position:relative;overflow:hidden;}
  .room{position:relative;height:320px;border-radius:10px;background:linear-gradient(180deg,#07101a,#0b0f12);display:flex;align-items:center;justify-content:center;overflow:hidden;border:1px solid rgba(255,255,255,0.03);margin-bottom:12px;}
  .tint{position:absolute;inset:0;mix-blend-mode:overlay;pointer-events:none;opacity:0.6;}
  .comments{position:absolute;left:8px;top:8px;height:260px;width:160px;overflow:hidden;display:flex;flex-direction:column;gap:6px;align-items:flex-start;justify-content:flex-start;padding-right:6px;}
  .comment{font-size:12px;padding:4px 6px;border-radius:6px;background:rgba(0,0,0,0.35);backdrop-filter:blur(4px);opacity:0.9;max-width:140px;color:#dfe8f6;}
  .comment.malformed{font-family:monospace;color:#c7ffb3;}
  .monitor{width:240px;height:140px;background:#0e1114;border-radius:4px;box-shadow:0 6px 20px rgba(0,0,0,0.6) inset;color:#dff;display:flex;align-items:center;justify-content:center;font-size:12px;}
  .monologue{margin-top:4px;background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;font-size:14px;color:#e9f1ff;min-height:72px;}
  .controls{display:flex;gap:10px;align-items:center;margin-top:10px;}
  button.btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;color:#e6eef8;cursor:pointer;}
  .memlist{margin-top:8px;background:rgba(255,255,255,0.01);padding:8px;border-radius:8px;font-size:13px;color:var(--muted);height:90px;overflow:auto;}
  .footer-note{margin-top:8px;font-size:13px;color:var(--muted);}
  @media (max-width:640px){.comments{display:none}}
</style>
</head>
<body>
<div class="wrap">
  <h1>SELF//SOUND — WORLD2 (Story)</h1>
  <div class="panel">
    <div class="room">
      <div class="tint" id="tint" style="background:rgba(24,128,64,0.35)"></div>
      <div class="comments" id="commentsArea"></div>
      <div class="monitor">pixel room</div>
    </div>

    <div class="monologue" id="monologue">ここはWORLD2。開始ボタンで記憶が動き出す。</div>

    <div class="controls">
      <button class="btn" id="startBtn">開始</button>
      <button class="btn" id="advanceBtn">進める</button>
      <button class="btn" id="memoryBtn">記憶を覗く</button>
      <div style="flex:1"></div>
      <a id="backW1" class="btn" href="world1_only.html">WORLD1に戻る</a>
    </div>

    <div class="memlist" id="memlist">記憶：—</div>
    <div class="footer-note">WORLD2ではコメントが化け、色が時間で変化します。真ENDは記憶の断片を集めると発生。</div>
  </div>
</div>

<script>
(function(){
  const $=(id)=>document.getElementById(id);
  let fans2=0, money2=0;
  const commentsPool=[
    "この音、なぜか▒▒▒▒落ち着く",
    "前の▒▒▒と似てる気がする",
    "思い▒▒▒▒した",
    "まだ▒▒▒▒▒▒",
    "この人、伸び方おかしくない？",
    "新人なのに妙に上手い",
    "前の人の曲思い出す",
    "この音好き",
    "夜に合う",
    "毎日聴いてる"
  ];
  const readablePool=["この音好き","夜に合う","毎日聴いてる","前の曲と似てる気がする","新人なのに妙に上手い","この人、伸び方おかしくない？"];

  function pushComment(txt, malformed=false){
    const area=$('commentsArea'); const c=document.createElement('div'); c.className='comment'+(malformed?' malformed':''); c.textContent=txt; area.prepend(c);
    while(area.children.length>18) area.removeChild(area.lastChild);
  }
  // prefill
  for(let i=0;i<6;i++){ pushComment(Math.random()<0.5?commentsPool[i]:readablePool[i], Math.random()<0.5); }

  const introLines=[
    '「前も、こんな活動をしていたような。」',
    '「……記憶が、ある。」',
    '「なぜかは、知らないが。」',
    '「少し、記憶を覗いてみたくなった。」',
    '「前の自分が、どうやって生活をしていたか。」',
    '「……何か、ヒントがあるはずだ。」'
  ];
  const redEventLines=[
    '「カーテンを、開けていないのに。」',
    '「なぜか、赤い。」',
    '「……作業が、しにくいな。」',
    '(数秒後)',
    '「色が、落ち着いてきた。」',
    '「さっきのは……幻覚か？」'
  ];
  const trueEnd2=[
    '「記憶の中の世界に、追いついたな。」',
    '「活動を、やめてもいい。」',
    '「やめなくても、いい。」',
    '「この世界が。」',
    '「この音楽が。」',
    '「未来に、残っていれば。」',
    '「目覚めの時間だ。」',
    '「私は、寝るが。」',
    '「ここまで、人気になれるとは思っていなかった。」',
    '「私の活動を、手伝い続けたあなたに。」',
    '「……とっておきの、感謝だ。」',
    '「あなたの為だけの、新曲。」',
    '「聴いて、くれるか？」'
  ];

  let inSeq=false;
  $('startBtn').addEventListener('click', ()=>{
    if(inSeq) return; inSeq=true; let i=0; $('monologue').textContent=introLines[0];
    const t=setInterval(()=>{ i++; if(i<introLines.length){ $('monologue').textContent=introLines[i]; if(Math.random()<0.6) pushComment(commentsPool[Math.floor(Math.random()*commentsPool.length)], Math.random()<0.5); } else { clearInterval(t); inSeq=false; $('memlist').textContent='記憶断片が見つかった。記憶を覗いてみよう。'; fans2+=40; money2+=200; } },1200);
    setTint('green');
  });

  function setTint(mode){
    const map={blue:'rgba(0,64,128,0.35)',purple:'rgba(96,48,112,0.35)',green:'rgba(24,128,64,0.35)',red:'rgba(160,24,24,0.38)'};
    $('tint').style.background=map[mode]||map.green;
  }

  $('advanceBtn').addEventListener('click', ()=>{
    const r=Math.random();
    if(r<0.25) setTint('blue'); else if(r<0.5) setTint('purple'); else if(r<0.8) setTint('green'); else setTint('red');
    if(Math.random()<0.7) pushComment(commentsPool[Math.floor(Math.random()*commentsPool.length)], Math.random()<0.5);
    fans2+=Math.floor(Math.random()*60); money2+=Math.floor(Math.random()*80);
    const lines=['「今日は音が逃げない気がする。」','「我ながら、いいアイデアが浮かんだ。早速、楽曲制作に取り掛かろう。」','「静かな夜だ。作るなら今。」'];
    $('monologue').textContent=lines[Math.floor(Math.random()*lines.length)];
    if($('tint').style.background.includes('160') && Math.random()<0.5){
      // red event
      let idx=0; $('monologue').textContent=redEventLines[idx];
      const z=setInterval(()=>{ idx++; if(idx<redEventLines.length){ $('monologue').textContent=redEventLines[idx]; } else clearInterval(z); },1000);
    }
    // attempt reveal some malformed comments occasionally
    if(Math.random()<0.12) revealMatches();
    checkTrueEnd();
  });

  $('memoryBtn').addEventListener('click', ()=>{
    const mem=[];
    for(let i=0;i<5;i++){ if(Math.random()<0.5) mem.push(readablePool[Math.floor(Math.random()*readablePool.length)]); else mem.push('▒▒▒▒▒▒▒▒▒'); }
    $('memlist').innerHTML = mem.map(x=>'• '+x).join('<br>');
  });

  function revealMatches(){
    const area=$('commentsArea');
    for(let i=0;i<area.children.length;i++){ const el=area.children[i]; if(el.textContent.includes('▒') && Math.random()<0.4){ el.textContent = readablePool[Math.floor(Math.random()*readablePool.length)]; el.classList.remove('malformed'); } }
  }

  function checkTrueEnd(){
    if(fans2>=300 && !inSeq){ inSeq=true; let idx=0; $('monologue').textContent=trueEnd2[0]; const v=setInterval(()=>{ idx++; if(idx<trueEnd2.length){ $('monologue').textContent=trueEnd2[idx]; } else { clearInterval(v); inSeq=false; $('memlist').innerHTML='WORLD2 真END到達（短縮版）。<br>WORLD1に戻るか、探索を続けてください。'; } },1200); }
  }

  // small periodic color hint (time simulation)
  setInterval(()=>{ const h=new Date().getHours()%24; if(h>=22||h<4) setTint('red'); else if(h>=18) setTint('purple'); else if(h>=8) setTint('blue'); else setTint('green'); },2000);

  // quick local save for prototype
  try{ const s=localStorage.getItem('selfsound_w2'); if(s){ const st=JSON.parse(s); fans2=st.fans2||fans2; } }catch(e){}
  setInterval(()=>{ localStorage.setItem('selfsound_w2', JSON.stringify({fans2,money2})); },1500);

})();
</script>
</body>
</html>
