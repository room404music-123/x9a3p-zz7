<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>WORLD1</title>
<style>
body {
  margin: 0;
  background: #0a1a2f; /* 暗めの青 */
  color: #e0ffe9;
  font-family: sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  height: 100vh;
  padding: 20px;
  position: relative;
}
h1 { margin-top: 0; }
.story {
  margin-top: 20px;
  font-size: 18px;
  line-height: 1.5em;
  max-width: 600px;
  text-align: left;
  min-height: 100px;
}
.button {
  margin-top: 20px;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
  background: #1f3f27;
  color: #e0ffe9;
  border: none;
  border-radius: 5px;
}
.comments {
  position: absolute;
  left: 10px;
  bottom: 20px;
  width: 300px;
  font-size: 16px;
  color: #a0ffc0;
}
.status {
  margin-top: 10px;
}
</style>
</head>
<body>
<h1>WORLD1</h1>
<div class="status">
  ファン数: <span id="fans">0</span>　|　お金: $<span id="money">0</span>
</div>
<div class="story" id="story">
タップしてセリフを表示
</div>
<button class="button" id="createSong">楽曲制作</button>
<div id="world2BtnContainer"></div>
<div class="comments" id="comments"></div>

<script>
let fanCount = 0;
let money = 0;
let songCount = 0;

const storyQueue = []; // キュー管理
let currentLines = [];
let lineIndex = 0;
let firstTap = true;

// 楽曲制作ストーリー
const songStoryData = [
  { text: `最近、DTMというものに興味がある。
とりあえず小さなノートパソコンとヘッドホンを買った。
今日から私もクリエイター.....？
浮かれる前に一曲作ってみよう。`, fans:0, money:0 },
  { text: `意外とパソコンの操作が難しかった。
某動画投稿サイトに曲をアップしてみたものの誰にも見つかる気がしない。
とりあえず今日は寝よう。`, fans:1, money:100 },
  { text: `曲作りにも慣れて来たな。
ファン数も順調に増えている。
ご褒美に旅行でもするか。`, fans:0, money:500 },
];

// ファン数ストーリー
const fanStoryData = [
  { fans:1, text: `....。
よく寝たな。
あ、
パソコン、閉じていなかったのか。
電気代が高くなりそうだな。
とりあえず閉じておこう。
....一件のコメント？
「めちゃくちゃ好きです！センスあると思います！」
ああ、私の曲を聴いてくれる人は、いたんだ。
やる気が湧いてくる。
私にとって一番最初のこのファンを、絶対大事にしよう。`, money:0, shown:false },
  { fans:10, text: `ふと、DTMを始める前の事を考える。
これまで見てきた配信者は皆ファンが数十万人いた。
でも、ファン数10人に喜んでいる自分がいる。
自然に笑みが溢れる。
これが、古参ってやつか。`, money:0, shown:false },
  { fans:100, text: `いつのまにかファンの数が増えていた。
これだけの人が私の音楽を愛してくれている...。
とても感慨深い。
ここまで来たらもう止まれない。
折角だから目標を決めてみよう。
次の目標は...`, money:100, shown:false },
];

// コメント
const commentList = [
  "応援してます！",
  "最高の曲でした！",
  "もっと聴きたい！",
  "センスある！",
  "毎日聴いてます！"
];

const storyDiv = document.getElementById('story');
const fansDiv = document.getElementById('fans');
const moneyDiv = document.getElementById('money');
const commentsDiv = document.getElementById('comments');
const songBtn = document.getElementById('createSong');
const world2Container = document.getElementById('world2BtnContainer');

function addStoryToQueue(story) {
  storyQueue.push(story);
}

function playNextStory() {
  if(storyQueue.length === 0) return;
  const story = storyQueue.shift();
  fanCount += story.fans;
  money += story.money;
  fansDiv.textContent = fanCount;
  moneyDiv.textContent = money;
  currentLines = story.text.split("\n");
  lineIndex = 0;
  storyDiv.textContent = currentLines[lineIndex];
}

function nextLine() {
  if(lineIndex < currentLines.length - 1){
    lineIndex++;
    storyDiv.textContent = currentLines[lineIndex];
  } else {
    playNextStory();
  }
}

// 初回タップ
document.body.addEventListener('click', (e)=>{
  if(firstTap){
    firstTap = false;
    storyDiv.textContent = "";
    addStoryToQueue(songStoryData[songCount]);
    playNextStory();
  } else if(e.target !== songBtn && e.target !== world2Container){
    nextLine();
  }
});

// 楽曲制作ボタン
songBtn.addEventListener('click', ()=>{
  if(songCount < songStoryData.length){
    songCount++;
    addStoryToQueue(songStoryData[songCount - 1]);
    // ファン数ストーリーでまだ表示していないものがあればキューに追加
    for(let fs of fanStoryData){
      if(fanCount >= fs.fans && !fs.shown){
        addStoryToQueue(fs);
        fs.shown = true;
      }
    }
    playNextStory();
  }
});

// コメント流す
function showComments() {
  const comment = commentList[Math.floor(Math.random() * commentList.length)];
  commentsDiv.textContent = comment;
}
setInterval(showComments, 5000);
</script>
</body>
</html>
